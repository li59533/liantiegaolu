# 炼钢\_通讯协议
**V0.0.2**

## 1.协议说明
**协议版本**：
协议类别：联能传感器私有协议

协议版本：V1.0.0

数据模式：\*\*

### 1.1 协议格式
```
typedef struct
{
	uint8_t head; //固定头标识
	uint8_t cmd; //报文类别
	uint16_t len; //payload长度
	uint8_t *payload; //
	uint8_t sum;  //校验和， 从cmd到payload结束
	uint8_t foot; //固定尾标识
}
```

## 2.协议内容
### 2.1 CMD说明
|序号|CMD|属性|说明|
|---|---|---|---|
|| 0x00 | 下发 | 暂无用                   |
||0x01|下发|开始根据时间工作|
||0x02|下发|获取SN码|
||0x04|下发|获取配置参数|
||0x05|下发|设置配置参数|
||0x06|下发|获取发送间隔|
||0x07|下发|设置发送间隔|
||0x08|下发|获取自启动方式|
||0x09|下发|设置自动启方式|
||0x0a|下发|复位电池|
||0x45|上报|上报数据|
||0x46|下发|低功耗设置（暂无用）|
||0x47|下发|获取基准时间|
||0x49|下发|设置基准时间|
||0x50||ACK（这个ACK有时间信息）|
||0x69|下发|ADC校准（4_20mA）|
||0x6a|下发|设置数据转换关系|
||0x88|下发|设置SN码|
||0xA0|下发|获取软件版本|

### 2.2 详细说明

#### 2.2.1 停止（0x00）
_暂时无用_

**类型：**请求，串口下发

**payload：**无

**返回：**返回相同报文

**例**：

发送：
	
```
	
```
返回：
	
```
	
```

#### 2.2.2 启动（0x01）
_启动_

**类型：**请求，串口下发

**payload：**无

**返回：**返回相同报文

**例**：

发送：
	
```

```

返回：
	
```

```

#### 2.2.3 获取SN码（0x02）
_获取SN码 ， 会触发停止发送_

**类型：**请求，串口下发

**payload：**无

**返回：**
相同CMD
```
{
	uint8_t SNcode[8]
}
```

**例**：

发送：
	
```

```

返回：
	
```

```
#### 2.2.4 获取配置信息（0x04）
_获取配置信息， 会触发停止发送_

**类型：**请求，串口下发

**payload：**无

**返回：**
相同CMD
```
{
	uint16_t dest_addr ; // 大端 ，目标地址
	uint8_t 0xc0 ; // 0xc0 固定值
	uint16_t src_addr ; // 大端 ， 源地址
	uint8_t module_conf[3] ; // [0]:空中速率、通讯波特率、校验方式
							// [1]: 频段
							// [2]: 发送功率、FEC校验、唤醒时间、IO工作模式、传输方式
}
```

**例**：

发送：
	
```

```

返回：
	
```

```
#### 2.2.5 设置配置信息（0x05）
_设置配置信息 ， 会触发停止发送_

**类型：**请求，串口下发

**payload：**
```
{
	uint16_t dest_addr ; // 目标地址 ， 大端
	uint16_t src_addr ; // 源地址 ， 大端
	uint8_t module_conf[3] ; // [0]:空中速率、通讯波特率、校验方式
							// [1]: 频段
							// [2]: 发送功率、FEC校验、唤醒时间、IO工作模式、传	
}
```

**返回：**
相同报文

**例**：

发送：
	
```

```

返回：
	
```

```
#### 2.2.6 获取发送间隔（0x06）
_获取发送间隔 ， 会触发停止发送_

**类型：**请求，串口下发

**payload：**
无

**返回：**
相同CMD
```
{
	uint8_t temp[3] ; // 空值，无用
	uint16_t interval ; // 时间间隔（s） ， 小端
	uint16_t temp[4] ; // 空值， 无用
}
```

**例**：

发送：
	
```

```

返回：
	
```

```
#### 2.2.7 设置发送间隔（0x07）
_设置发送间隔 ， 会触发停止发送_

**类型：**请求，串口下发

**payload：**
```
{
	uint8_t temp[3] ; // 空值，无用
	uint16_t interval ; // 时间间隔（s） ， 小端
	uint16_t temp[4] ; // 空值， 无用
}
```

**返回：**
相同报文

**例**：

发送：
	
```

```

返回：
	
```

```
#### 2.2.8 获取自启方式（0x08）
_获取自启动方式_

**类型：**请求，串口下发

**payload：**
无

**返回：**
相同CMD
```
{
	uint8_t temp[4] ; // 空值，无用
}
```

**例**：

发送：
	
```

```

返回：
	
```

```
#### 2.2.9 设置自启方式（0x09）
_设置自启动方式，暂无用_

**类型：**请求，串口下发

**payload：**
无

**返回：**
相同报文

**例**：

发送：
	
```

```

返回：
	
```

```
#### 2.2.10 设置电池（0x0A）
_设置电池_

**类型：**请求，串口下发

**payload：**
```
{
	uint32_t boardtime ; // 设置板子已经发送的次数，大端
}
```

**返回：**
相同报文

**例**：

发送：
	
```

```

返回：
	
```

```


#### 2.2.11 上报数据（0x45） 
_上报数据_

**类型：**上报，lora

**payload：**
```
{
	uint8_t 0x01 ; // 定值
	float value ; // 上报值
	uint8_t battery ; // 电量
	uint16_t src_addr ; // 源地址， 大端
	uint16_t src_addr ; // 原地址， 大端 （两遍~~）
	uint16_t year  ; // 年 ,大端
	uint8_t mon ; // 月
	uint8_t day ; // 日
	uint8_t hour ; // 时
	uint8_t min ; // 分
	uint8_t sec ; // 秒
}
```
**说明！！！！**
<font color=red>此条报文，len+1 ，双字节和校验</font>

**返回：**
无

**例**：

发送：
	
```

```

返回：
	
```

```
#### 2.2.12 低功耗设置（0x46）
_低功耗设置 ， 暂无用_

**类型：**请求，串口

**payload：**
无
**说明**
无

**返回：**
相同报文

**例**：

发送：
	
```

```

返回：
	
```

```
#### 2.2.13 获取基准时间（0x47）
_获取基准时间_

**类型：**请求，串口

**payload：**
无
**说明**
无

**返回：**
相同CMD
```
{
	uint16_t year  ; // 年 ,小端
	uint8_t mon ; // 月
	uint8_t day ; // 日
	uint8_t hour ; // 时
	uint8_t min ; // 分
	uint8_t sec ; // 秒	
}
```

**例**：

发送：
	
```

```

返回：
	
```

```
#### 2.2.14 设置基准时间（0x49）
_设置基准时间_

**类型：**请求，串口

**payload：**
```
{
	uint16_t year  ; // 年 ,小端
	uint8_t mon ; // 月
	uint8_t day ; // 日
	uint8_t hour ; // 时
	uint8_t min ; // 分
	uint8_t sec ; // 秒	
}
```

**说明**
无

**返回：**
无

**例**：

发送：
	
```

```

返回：
	
```

```
#### 2.2.15 ACK（0x50）
_上报数据的ACK_

**类型：**ack，lora

**payload：**
```
{
	uint16_t year  ; // 年 ,小端
	uint8_t mon ; // 月
	uint8_t day ; // 日
	uint8_t hour ; // 时
	uint8_t min ; // 分
	uint8_t sec ; // 秒	
}
```

**说明**
此ACK带时间信息。

**返回：**
无

**例**：

发送：
	
```

```

返回：
	
```

```
#### 2.2.16 4_20mA校准（0x69）
_4\_20mA校准 ， 会触发停止发送_

**类型：**请求，串口

**payload：**
```
{
	uint8_t mA_4_flag ; // =1 ,触发校准4mA
	uint8_t mA_20_flag ; // =1 , 触发校准20mA
}
```

**说明**


**返回：**
无

**例**：

发送：
	
```

```

返回：
	
```

```

#### 2.2.17 设置数据转换关系（0x6A）
_设置数据转换关系 ,会触发停止发送_

**类型：**请求，串口

**payload：**
```
{
	float mA_4_Value ; // 4mA代表的值
	flaot mA_20_Value ; // 20mA代表的值
}
```

**说明**


**返回：**
若配置成功，返回：
相同CMD
```
{
	0x01 , 
}
```

**例**：

发送：
	
```

```

返回：
	
```

```
#### 2.2.18 设置SN码（0x88）
_设置SN码_

**类型：**请求，串口

**payload：**

```
{
	uint8_t SNcode[8] ; 
}
```

**说明**

**返回：**
相同报文。

**例**：

发送：
	
```

```

返回：
	
```

```

#### 2.2.19 获取软件版本（0xA0）
_获取软件版本_

**类型：**请求，串口

**payload：**
无
**说明**

**返回：**
相同CMD。

```
{
	uint32_t Version ; //小端
}

//version = VERSION_MAJOR * 256 * 256 | VERSION_MINOR * 256 |VERSION_LITE; 

```

**例**：

发送：
	
```

```

返回：
	
```

```
